(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))i(l);new MutationObserver(l=>{for(const s of l)if(s.type==="childList")for(const n of s.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&i(n)}).observe(document,{childList:!0,subtree:!0});function t(l){const s={};return l.integrity&&(s.integrity=l.integrity),l.referrerPolicy&&(s.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?s.credentials="include":l.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(l){if(l.ep)return;l.ep=!0;const s=t(l);fetch(l.href,s)}})();const h={CANVAS_WIDTH:360,CANVAS_HEIGHT:640,ISO_SCALE_X:.5,ISO_SCALE_Y:.25,GRAVITY:0,FRICTION:.96,STOP_THRESHOLD:.05,MAX_POWER:15,POWER_SCALE:.08,WALL_BOUNCE:.7,BALL_RADIUS:6,HOLE_RADIUS:10,MAGNET_DIST:20,MAGNET_FORCE:.1,WIN_DIST:8,MAX_LIVES:3,CTA_URL:"https://github.com/IdzumIVlad",WORLD_OFFSET_X:260,WORLD_OFFSET_Y:200,CONFETTI_COUNT:100,CONFETTI_GRAVITY:.2,CONFETTI_DRAG:.95,COLORS:{bg:"#87CEEB",floor:"#4CAF50",floorDark:"#388E3C",wall:"#8D6E63",wallTop:"#A1887F",ball:"#FFFFFF",hole:"#212121",aimLine:"#FFFF00",powerLine:"#FF0000",grid:"rgba(0, 0, 0, 0.1)",heart:"#F44336",heartEmpty:"#BDBDBD"}};class a{x;y;static pool=[];constructor(e,t){this.x=e,this.y=t}static acquire(e,t){if(a.pool.length>0){let i=a.pool.pop();return i.x=e,i.y=t,i}return new a(e,t)}release(){a.pool.push(this)}add(e){return e?new a(this.x+e.x,this.y+e.y):this}sub(e){return e?new a(this.x-e.x,this.y-e.y):this}mult(e){return new a(this.x*e,this.y*e)}set(e,t){return this.x=e,this.y=t,this}copy(e){return e?(this.x=e.x,this.y=e.y,this):this}addMut(e){return e?(this.x+=e.x,this.y+=e.y,this):this}subMut(e){return e?(this.x-=e.x,this.y-=e.y,this):this}multMut(e){return this.x*=e,this.y*=e,this}mag(){return Math.sqrt(this.x*this.x+this.y*this.y)}norm(){let e=this.mag();return e>0?new a(this.x/e,this.y/e):new a(0,0)}normMut(){let e=this.mag();return e>0?(this.x/=e,this.y/=e):(this.x=0,this.y=0),this}}const g=[{start:new a(100,400),hole:new a(100,100),walls:[{x:0,y:0,w:200,h:10},{x:0,y:490,w:200,h:10},{x:0,y:0,w:10,h:500},{x:190,y:0,w:10,h:500}],obstacles:[]},{start:new a(100,400),hole:new a(100,100),walls:[{x:0,y:0,w:200,h:10},{x:0,y:490,w:200,h:10},{x:0,y:0,w:10,h:500},{x:190,y:0,w:10,h:500},{x:60,y:240,w:80,h:20}],obstacles:[]},{start:new a(100,400),hole:new a(100,100),walls:[{x:0,y:0,w:200,h:10},{x:0,y:490,w:200,h:10},{x:0,y:0,w:10,h:500},{x:190,y:0,w:10,h:500}],obstacles:[{type:"moving_wall",x:20,y:220,w:40,h:20,speed:2,range:120,dir:1,startX:20}]}];class T{canvas;ctx;bgCanvas;bgCtx;width;height;constructor(e){this.canvas=e,this.ctx=e.getContext("2d"),this.ctx.imageSmoothingEnabled=!1,this.bgCanvas=document.createElement("canvas"),this.bgCtx=this.bgCanvas.getContext("2d"),this.bgCtx.imageSmoothingEnabled=!1,this.width=h.CANVAS_WIDTH,this.height=h.CANVAS_HEIGHT,this.canvas.width=this.width,this.canvas.height=this.height,this.resize(),window.addEventListener("resize",()=>this.resize())}resize(){let e=Math.min(window.innerWidth/this.width,window.innerHeight/this.height);this.canvas.style.width=this.width*e+"px",this.canvas.style.height=this.height*e+"px"}clear(){this.ctx.clearRect(0,0,this.width,this.height)}worldToScreen(e){if(!e)return new a(0,0);let t=(e.x-e.y)*h.ISO_SCALE_X,i=(e.x+e.y)*h.ISO_SCALE_Y;return new a(t+h.WORLD_OFFSET_X,i+h.WORLD_OFFSET_Y)}screenToWorld(e){if(!e)return new a(0,0);let t=e.x-h.WORLD_OFFSET_X,i=e.y-h.WORLD_OFFSET_Y,l=(i/h.ISO_SCALE_Y-t/h.ISO_SCALE_X)/2,s=(i/h.ISO_SCALE_Y+t/h.ISO_SCALE_X)/2;return new a(s,l)}drawIsoRect(e,t,i,l,s,n=0,r=this.ctx){let d=a.acquire(e,t),o=a.acquire(e+i,t),m=a.acquire(e+i,t+l),u=a.acquire(e,t+l),S=this.worldToScreen(d),y=this.worldToScreen(o),c=this.worldToScreen(m),f=this.worldToScreen(u);if(S.y-=n,y.y-=n,c.y-=n,f.y-=n,r.fillStyle=s,r.beginPath(),r.moveTo(S.x,S.y),r.lineTo(y.x,y.y),r.lineTo(c.x,c.y),r.lineTo(f.x,f.y),r.closePath(),r.fill(),r.strokeStyle="rgba(0,0,0,0.2)",r.stroke(),n>0){let w=20*h.ISO_SCALE_X;r.fillStyle=h.COLORS.wall,r.beginPath(),r.moveTo(y.x,y.y),r.lineTo(c.x,c.y),r.lineTo(c.x,c.y+w),r.lineTo(y.x,y.y+w),r.closePath(),r.fill(),r.beginPath(),r.moveTo(c.x,c.y),r.lineTo(f.x,f.y),r.lineTo(f.x,f.y+w),r.lineTo(c.x,c.y+w),r.closePath(),r.fill(),r.fillStyle=h.COLORS.wallTop,r.beginPath(),r.moveTo(S.x,S.y),r.lineTo(y.x,y.y),r.lineTo(c.x,c.y),r.lineTo(f.x,f.y),r.closePath(),r.fill(),r.stroke()}d.release(),o.release(),m.release(),u.release()}drawCircleIso(e,t,i){let l=this.worldToScreen(e);this.ctx.fillStyle=i,this.ctx.beginPath();let s=t*h.ISO_SCALE_X*2;this.ctx.ellipse(l.x,l.y,s,s*.6,0,0,Math.PI*2),this.ctx.fill(),this.ctx.strokeStyle="rgba(0,0,0,0.5)",this.ctx.stroke()}drawBallIso(e,t){let i=this.worldToScreen(e),l=t*h.ISO_SCALE_X*2;this.ctx.fillStyle="rgba(0,0,0,0.3)",this.ctx.beginPath(),this.ctx.ellipse(i.x,i.y+2,l,l*.6,0,0,Math.PI*2),this.ctx.fill();let s=i.y-4;this.ctx.fillStyle=h.COLORS.ball,this.ctx.beginPath(),this.ctx.arc(i.x,s,l,0,Math.PI*2),this.ctx.fill();let n=this.ctx.createRadialGradient(i.x-l*.3,s-l*.3,l*.1,i.x,s,l);n.addColorStop(0,"white"),n.addColorStop(1,"#cccccc"),this.ctx.fillStyle=n,this.ctx.fill(),this.ctx.strokeStyle="#999",this.ctx.lineWidth=1,this.ctx.stroke()}renderBackgroundToCache(e){this.bgCanvas.width=this.width,this.bgCanvas.height=this.height;let t=20;for(let i=0;i<200;i+=t)for(let l=0;l<500;l+=t){let s=(i/t+l/t)%2===0?h.COLORS.floor:h.COLORS.floorDark;this.drawIsoRect(i,l,t,t,s,0,this.bgCtx)}e&&e.walls.forEach(i=>{this.drawIsoRect(i.x,i.y,i.w,i.h,h.COLORS.wallTop,1,this.bgCtx)})}drawBackgroundFromCache(){this.ctx.drawImage(this.bgCanvas,0,0)}}class v{constructor(){}checkRectCollision(e,t,i){let l=Math.max(e.x,Math.min(t.x,e.x+e.w)),s=Math.max(e.y,Math.min(t.y,e.y+e.h)),n=t.x-l,r=t.y-s;return Math.sqrt(n*n+r*r)<i?a.acquire(n,r).normMut():null}update(e,t,i){t.obstacles.forEach(s=>{s.type==="moving_wall"&&(s.x+=(s.speed||0)*(s.dir||1),(s.x>(s.startX||0)+(s.range||0)||s.x<(s.startX||0))&&s.dir!==void 0&&(s.dir*=-1))});let l=null;if(i==="MOVING"&&e.active){let s=a.acquire(e.pos.x,e.pos.y).addMut(e.vel),n=[...t.walls];t.obstacles.forEach(d=>{d.type==="moving_wall"&&n.push(d)});let r=!1;for(let d of n){let o=this.checkRectCollision(d,s,e.radius);if(o){let m=e.vel.x*o.x+e.vel.y*o.y,u=o.mult(2*m);e.vel.subMut(u).multMut(h.WALL_BOUNCE),e.pos.addMut(o),r=!0,o.release(),u.release()}}r||(e.pos.addMut(e.vel),e.vel.multMut(h.FRICTION)),s.release(),e.vel.mag()<h.STOP_THRESHOLD&&e.vel.set(0,0)}if(e.active){let s=e.pos.sub(t.hole).mag();if(s<h.MAGNET_DIST&&e.vel.mag()<3){let n=t.hole.sub(e.pos).normMut(),r=n.multMut(h.MAGNET_FORCE);e.vel.addMut(r),n.release()}s<h.WIN_DIST&&(e.vel.set(0,0),e.pos.copy(t.hole),l="WON")}return l}}class p{pos;vel;size;color;life;decay;static pool=[];constructor(e,t){this.pos=new a(e,t),this.vel=new a(0,0),this.size=0,this.color="#fff",this.life=0,this.decay=0,this.reset(e,t)}reset(e,t){this.pos.set(e,t),this.vel.set((Math.random()-.5)*10,(Math.random()-1)*10),this.size=Math.random()*6+2,this.life=1,this.decay=Math.random()*.01+.005;let i=["#F44336","#E91E63","#9C27B0","#3F51B5","#2196F3","#00BCD4","#009688","#4CAF50","#8BC34A","#CDDC39","#FFEB3B","#FFC107","#FF9800","#FF5722"];this.color=i[Math.floor(Math.random()*i.length)]}static acquire(e,t){if(p.pool.length>0){let i=p.pool.pop();return i.reset(e,t),i}return new p(e,t)}release(){p.pool.push(this)}update(){this.vel.y+=h.CONFETTI_GRAVITY,this.vel.multMut(h.CONFETTI_DRAG),this.pos.addMut(this.vel),this.life-=this.decay}draw(e){e.globalAlpha=this.life,e.fillStyle=this.color,e.fillRect(this.pos.x,this.pos.y,this.size,this.size),e.globalAlpha=1}}class I{canvas;renderer;physics;ball;levelIndex;lives;gameState;currentLevel;dragStart;dragCurrent;ui;clouds;particles;lastTime;constructor(){this.canvas=document.getElementById("gameCanvas"),this.renderer=new T(this.canvas),this.physics=new v,this.ball={pos:new a(0,0),vel:new a(0,0),radius:h.BALL_RADIUS,active:!1,activate:function(e,t){this.pos.set(e,t),this.vel.set(0,0),this.active=!0}},this.levelIndex=0,this.lives=h.MAX_LIVES,this.gameState="AIMING",this.currentLevel=g[0],this.dragStart=null,this.dragCurrent=null,this.ui={level:document.getElementById("level-display"),hearts:document.getElementById("hearts-container"),overlay:document.getElementById("message-overlay"),title:document.getElementById("message-text"),nextBtn:document.getElementById("next-btn"),resetBtn:document.getElementById("reset-btn"),ctaBtn:document.getElementById("cta-btn")},this.clouds=[],this.particles=[],this.bindEvents(),this.initClouds(),this.loadLevel(0),this.lastTime=0,requestAnimationFrame(e=>this.loop(e))}bindEvents(){this.canvas.addEventListener("pointerdown",e=>this.handleInputStart(e)),this.canvas.addEventListener("pointermove",e=>this.handleInputMove(e)),window.addEventListener("pointerup",e=>this.handleInputEnd(e)),this.ui.resetBtn.addEventListener("click",()=>this.loadLevel(this.levelIndex)),this.ui.nextBtn.addEventListener("click",()=>this.loadLevel(this.levelIndex+1))}getCanvasPos(e){let t=this.canvas.getBoundingClientRect(),i=this.canvas.width/t.width,l=this.canvas.height/t.height;return new a((e.clientX-t.left)*i,(e.clientY-t.top)*l)}handleInputStart(e){if(this.gameState!=="AIMING")return;e.preventDefault();let t=this.getCanvasPos(e),i=this.renderer.worldToScreen(this.ball.pos);t.sub(i).mag()<40&&(this.dragStart=t,this.dragCurrent=t)}handleInputMove(e){this.dragStart&&(e.preventDefault(),this.dragCurrent=this.getCanvasPos(e))}handleInputEnd(e){if(!this.dragStart||!this.dragCurrent)return;let i=this.dragStart.sub(this.dragCurrent).mag()*h.POWER_SCALE;if(i>1){i>h.MAX_POWER&&(i=h.MAX_POWER);let l=this.renderer.screenToWorld(this.dragStart),s=this.renderer.screenToWorld(this.dragCurrent),n=l.sub(s);i=n.mag()*.15,i>h.MAX_POWER&&(i=h.MAX_POWER);let r=n.norm().mult(i);this.ball.vel=r,this.gameState="MOVING",this.lives--,this.updateHUD()}this.dragStart=null,this.dragCurrent=null}loadLevel(e){this.levelIndex=e,this.levelIndex>=g.length&&(this.levelIndex=0);let t=g[this.levelIndex],i=[];t.obstacles&&(i=t.obstacles.map(l=>({...l}))),this.currentLevel={start:t.start,hole:t.hole,walls:t.walls,obstacles:i},this.ball.activate(t.start.x,t.start.y),this.lives=h.MAX_LIVES,this.gameState="AIMING",this.particles=[],this.renderer.renderBackgroundToCache(this.currentLevel),this.updateHUD(),this.ui.overlay.classList.add("hidden"),this.ui.ctaBtn.classList.add("hidden")}updateHUD(){this.ui.level.textContent=(this.levelIndex+1).toString();let e="";for(let t=0;t<h.MAX_LIVES;t++)e+=t<this.lives?"â¤ï¸":"ðŸ–¤";this.ui.hearts.innerHTML=e}initClouds(){this.clouds=[];for(let e=0;e<8;e++)this.clouds.push({x:Math.random()*h.CANVAS_WIDTH,y:Math.random()*h.CANVAS_HEIGHT,speed:.2+Math.random()*.2,size:30+Math.random()*40,opacity:.4+Math.random()*.3})}updateClouds(){this.clouds.forEach(e=>{e.x+=e.speed,e.x>h.CANVAS_WIDTH+e.size*2&&(e.x=-e.size*2,e.y=Math.random()*h.CANVAS_HEIGHT,e.speed=.2+Math.random()*.2)})}drawClouds(){this.clouds.forEach(e=>{this.renderer.ctx.fillStyle=`rgba(255, 255, 255, ${e.opacity})`,this.renderer.ctx.beginPath(),this.renderer.ctx.arc(e.x,e.y,e.size,0,Math.PI*2),this.renderer.ctx.arc(e.x-e.size*.8,e.y+e.size*.3,e.size*.7,0,Math.PI*2),this.renderer.ctx.arc(e.x+e.size*.8,e.y+e.size*.3,e.size*.7,0,Math.PI*2),this.renderer.ctx.fill()})}spawnConfetti(){let e=this.renderer.worldToScreen(this.currentLevel.hole);for(let t=0;t<h.CONFETTI_COUNT;t++)this.particles.push(p.acquire(e.x,e.y))}loop(e){try{this.lastTime=e,this.updateClouds();for(let i=this.particles.length-1;i>=0;i--){let l=this.particles[i];l.update(),l.life<=0&&(l.release(),this.particles.splice(i,1))}let t=this.physics.update(this.ball,this.currentLevel,this.gameState);t==="WON"&&this.gameState!=="WON"&&(this.gameState="WON",this.ui.title.innerText="Nice!",this.spawnConfetti(),this.ui.overlay.classList.remove("hidden"),this.ui.ctaBtn.href=h.CTA_URL,this.ui.ctaBtn.classList.remove("hidden")),t===null&&this.ball.vel.mag()===0&&this.gameState==="MOVING"&&(this.lives<=0?(this.ui.title.innerText="Try Again!",this.ui.ctaBtn.classList.add("hidden"),setTimeout(()=>this.loadLevel(this.levelIndex),1e3)):this.gameState="AIMING"),this.renderer.clear(),this.drawClouds(),this.renderer.drawBackgroundFromCache(),this.renderer.drawCircleIso(this.currentLevel.hole,h.HOLE_RADIUS,h.COLORS.hole),this.currentLevel.obstacles.forEach(i=>{this.renderer.drawIsoRect(i.x,i.y,i.w,i.h,"#F44336",1)}),this.ball.active&&this.renderer.drawBallIso(this.ball.pos,this.ball.radius),this.particles.forEach(i=>i.draw(this.renderer.ctx)),this.dragStart&&this.gameState==="AIMING"?(this.drawDragLine(),this.drawClub()):this.gameState==="AIMING"&&this.drawClub(),requestAnimationFrame(i=>this.loop(i))}catch(t){console.error(t),this.ui.title.innerText="Error: "+t.message,this.ui.overlay.classList.remove("hidden")}}drawDragLine(){if(!this.dragStart||!this.dragCurrent)return;let e=this.dragStart,t=this.dragCurrent,i=t.sub(e),l=h.MAX_POWER/h.POWER_SCALE;i.mag()>l&&(i=i.norm().mult(l),t=e.add(i));let n=i.mag()*h.POWER_SCALE/h.MAX_POWER,r=this.renderer.worldToScreen(this.ball.pos),d=r.sub(i),o=this.renderer.ctx;o.beginPath(),o.moveTo(r.x,r.y),o.lineTo(t.x,t.y),o.strokeStyle="rgba(255, 255, 255, 0.5)",o.setLineDash([5,5]),o.stroke();let u=`hsl(${120*(1-n)}, 100%, 50%)`;o.beginPath(),o.moveTo(r.x,r.y),o.lineTo(d.x,d.y),o.strokeStyle=u,o.lineWidth=3,o.setLineDash([]),o.stroke()}drawClub(){let e=60,t=this.renderer.worldToScreen(this.ball.pos);t.y-=e;let i,l=0;if(this.dragStart&&this.dragCurrent){let o=this.renderer.screenToWorld(this.dragCurrent),u=o.sub(this.ball.pos).mag();l=Math.min(u*.4,40),i=this.renderer.worldToScreen(o),i.y-=l}else i=this.renderer.worldToScreen(this.ball.pos.add(new a(5,5)));let s=this.renderer.ctx;s.strokeStyle="#B0BEC5",s.lineWidth=3,s.lineCap="round",s.beginPath(),s.moveTo(t.x,t.y),s.lineTo(i.x,i.y),s.stroke();let n=t.x-i.x,r=t.y-i.y,d=Math.atan2(r,n);s.save(),s.translate(i.x,i.y),s.rotate(d-Math.PI/2),s.fillStyle="#455A64",s.beginPath(),s.moveTo(0,0),s.lineTo(4,0),s.lineTo(8,12),s.lineTo(-6,12),s.lineTo(-2,0),s.closePath(),s.fill(),s.fillStyle="#78909C",s.fillRect(-4,9,8,1),s.restore()}}window.onload=()=>{new I};
